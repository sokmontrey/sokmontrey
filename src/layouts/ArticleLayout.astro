---
import BaseLayout from '@/layouts/BaseLayout.astro';
import ThemeToggle from '@/components/ThemeToggle.svelte';
import ArticleHeader from '@/components/ArticleHeader.svelte';
import ArticleSectionBar from '@/components/ArticleSectionBar.svelte';

import '@/styles/article.css';

const { frontmatter } = Astro.props;
---

<BaseLayout title={frontmatter.title}>
    <div
        id="topbar-header"
        class="box-border transition-all duration-300 ease-in-out w-full overflow-hidden justify-between items-center flex py-8 px-8 sticky top-0 z-10 bg-transparent xl:opacity-100 "
    >
        <a href='/articles' slot="left" class='flex items-center'>
            <i class="fa-solid fa-chevron-left"></i>
            <p class='text-lg font-serif pl-4 ' >
                Stuffs I <span class="pm-color">Wrote</span>.
            </p>
        </a>
        <ThemeToggle client:only='svelte' />
    </div>
    <header class='mx-auto flex flex-col pt-[0%] w-[85%] md:w-[80%] lg:w-[100%] lg:grid lg:grid-cols-2 lg:h-[82vh] '>
        <div class=' lg:col-start-1 lg:px-[23%] xl:px-[26%] flex flex-col justify-center '>
            <h2 class="font-serif pm-color font-bold my-0 text-[2.5rem] xl:text-[2.8rem] ">
                {frontmatter.title}
            </h2>
            <div class="flex flex-wrap my-5 ">
                {frontmatter.tags.map((tag) =>
                <span class="bg-ft-color px-[0.5rem] m-[0.1rem] text-sm rounded-xl">
                    #{tag}
                </span>)}
            </div>
        </div>

        <div class=' lg:col-start-2 lg:px-[23%] xl:px-[26%] self-center '>
            <p class="opacity-50 ">
                {frontmatter.date}
            </p>
            <p class="opacity-80 mt-4 ">
                {frontmatter.description}
            </p>
        </div>
    </header>

    <hr class='mt-8 lg:hidden '>
    <div
        class="hidden lg:block border border-dashed border-[var(--ft-color)] fixed h-[100vh] w-[0px] left-[50%] top-0 z-[300]"
    ></div>

    <main class='w-[85%] mx-auto md:w-[73%] md:pt-[5%] lg:w-[100%] lg:grid lg:grid-cols-2 lg:px-[7.5%] lg:gap-x-[15%] '>
        <slot />
    </main>

    <ArticleSectionBar client:only="svelte" />
</BaseLayout>

<script>
    const topbar_element = document.getElementById("topbar-header");
    let last_scroll_top = 0;
    let is_down = false;

    function checkHeader() {
        let st = window.scrollY || document.documentElement.scrollTop;
        if (st > last_scroll_top && !is_down) {
            is_down = true;
            topbar_element.classList.add("opacity-0");
        } else if (st < last_scroll_top && is_down) {
            is_down = false;
            topbar_element.classList.remove("opacity-0");
        }
        last_scroll_top = st <= 0 ? 0 : st;
    }

    window.addEventListener( "scroll", () => checkHeader());
</script>
