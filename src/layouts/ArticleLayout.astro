---
import BaseLayout from '@/layouts/BaseLayout.astro';
import ThemeToggle from '@/components/ThemeToggle.svelte';
import ArticleHeader from '@/components/ArticleHeader.svelte';
import ArticleSectionBar from '@/components/ArticleSectionBar.svelte';

const { frontmatter } = Astro.props;
---

<BaseLayout title={frontmatter.title}>
    <header
        id="topbar-header"
        class="box-border transition-all duration-300 ease-in-out w-full overflow-hidden justify-between items-center flex py-8 px-8 sticky top-0 z-10 bg-transparent lg:opacity-100 "
    >
        <a href='/articles' slot="left" class='flex items-center'>
            <i class="fa-solid fa-chevron-left"></i>
            <p class='text-lg font-serif pl-4 ' >
                Stuffs I <span class="pm-color">Wrote</span>.
            </p>
        </a>
        <ThemeToggle client:only='svelte' />
    </header>

    <main class='mx-auto pt-[0%] w-[85%] md:w-[60%] lg:w-[45%] xl:w-[38%] '>
        <ArticleHeader
            title={frontmatter.title}
            date={frontmatter.date}
            tags={frontmatter.tags}
            description={frontmatter.description} />

        <hr class='my-4 mb-8'>

        <ArticleSectionBar client:only="svelte" />

        <div class='w-[90%] mx-auto'>
            <slot />
        </div>
    </main>
</BaseLayout>

<script>
    const topbar_element = document.getElementById("topbar-header");
    let last_scroll_top = 0;
    let is_down = false;

    function checkHeader() {
        let st = window.scrollY || document.documentElement.scrollTop;
        if (st > last_scroll_top && !is_down) {
            is_down = true;
            topbar_element.classList.add("opacity-0");
        } else if (st < last_scroll_top && is_down) {
            is_down = false;
            topbar_element.classList.remove("opacity-0");
        }
        last_scroll_top = st <= 0 ? 0 : st;
    }

    window.addEventListener( "scroll", () => checkHeader());
</script>
