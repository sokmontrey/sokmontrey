---
import BaseLayout from '@/layouts/BaseLayout.astro';
import ThemeToggle from '@/components/ThemeToggle.svelte';
import ArticleSectionBar from '@/components/ArticleSectionBar.svelte';

const { frontmatter } = Astro.props;
---

<BaseLayout title={frontmatter.title}>
    <div
        id="topbar-header"
        class="box-border transition-all duration-300 ease-in-out w-full overflow-hidden justify-between items-center flex py-8 px-8 fixed top-0 z-10 bg-transparent xl:opacity-100 "
    >
        <a href='/articles' slot="left" class='flex items-center'>
            <i class="fa-solid fa-chevron-left"></i>
            <p class='text-lg font-serif pl-4 my-0 ' >
                Stuffs I <span class="pm-color">Wrote</span>.
            </p>
        </a>
        <ThemeToggle client:only='svelte' />
    </div>

    <header class='mx-auto flex flex-col pt-[20%] md:pt-[16%] lg:pt-[0%] w-[85%] md:w-[70%] lg:w-[100%] lg:flex-row lg:h-[100vh] '>
        <div class=' flex flex-col justify-center lg:text-right lg:flex-1 lg:px-[3%] lg:pl-[9%] lg:items-end '>
            <h2 class="font-serif pm-color font-bold my-0 text-[1.7rem] xl:text-[2.1rem] lg:w-[85%] xl:w-[55%] ">
                {frontmatter.title}
            </h2>
            <div class="flex flex-wrap my-5 lg:justify-end lg:w-[85%] xl:w-[60%] ">
                {frontmatter.tags.map((tag) =>
                <span class="bg-ft-color px-[0.5rem] m-[0.1rem] text-sm rounded-xl">
                    #{tag}
                </span>)}
            </div>
        </div>

        <div class=' flex flex-col self-center lg:flex-1 lg:px-[3%] lg:pr-[9%] '>
            <p class="opacity-50 font-mono p-0 ">
                {frontmatter.date}
            </p>
            <p class="opacity-80 mt-4 p-0 lg:w-[80%] xl:w-[70%] ">
                {frontmatter.description}
            </p>
        </div>
    </header>

    <hr class='mt-8 mt-[10%] w-[100px] mx-auto '>

    <main class='w-[85%] mx-auto mb-[20%] md:w-[73%] lg:w-[45%] xl:w-[35%] '>
        <slot />
    </main>

    <ArticleSectionBar client:only="svelte" />
</BaseLayout>

<script>
    const topbar_element = document.getElementById("topbar-header");
    let last_scroll_top = 0;
    let is_down = false;

    function checkHeader() {
        let st = window.scrollY || document.documentElement.scrollTop;
        if (st > last_scroll_top && !is_down) {
            is_down = true;
            topbar_element.classList.add("opacity-0");
        } else if (st < last_scroll_top && is_down) {
            is_down = false;
            topbar_element.classList.remove("opacity-0");
        }
        last_scroll_top = st <= 0 ? 0 : st;
    }

    window.addEventListener( "scroll", () => checkHeader());
</script>
