---
import BaseLayout from '@/layouts/BaseLayout.astro';

import ArticlePost from '@/components/ArticlePost.svelte';
import ThemeToggle from '@/components/ThemeToggle.svelte';

const articles = await Astro.glob('./**/index.mdx');
const thumbnails = await Astro.glob('./**/Thumbnail.astro');
---

<BaseLayout title="Articles">
    <header
        id="topbar-header"
        class="box-border transition-all duration-300 ease-in-out w-full backdrop-blur-md overflow-hidden justify-between items-center flex py-8 px-8 sticky top-0 bg-bg-color bg-red-500 z-10"
    >
        <div slot="left" class='flex items-center'>
            <a href="/" class='pr-4'>
                <i class="fa-solid fa-chevron-left"></i>
            </a>
            <h1 class='text-lg ' >
                Stuffs I <span class="pm-color">Wrote</span>.
            </h1>
        </div>
        <ThemeToggle client:only='svelte' />
    </header>

    <main class='w-[85%] mx-auto pt-4 '>
        {articles.map((article, i) => { 
            const thumbnail = thumbnails[i]; 
            return <ArticlePost
                date={article.frontmatter.date}
                title={article.frontmatter.title}
                description={article.frontmatter.description}
                url={article.url}
            >
                <thumbnail.default slot="thumbnail" />
            </ArticlePost>} )}
    </main>
</BaseLayout>

<script>
    const topbar_element = document.getElementById("topbar-header");
    var last_scroll_top = 0;
    window.addEventListener(
        "scroll",
        () => {
            var st = window.scrollY || document.documentElement.scrollTop;
            if (st > last_scroll_top) {
                topbar_element.classList.add("opacity-0");
            } else if (st < last_scroll_top) {
                topbar_element.classList.remove("opacity-0");
            }
            last_scroll_top = st <= 0 ? 0 : st;
        },
        false,
    );
</script>
