---
layout: "@/layouts/ArticleLayout.astro"
title: Taking Derivative Automatically with Computational Graph
description: At the heart of many machine learning algorithms, there are functions and derivatives. How can a computer program find the derivative of a function automatically? We will explore the concept of computational graph and automatic differentiation. 
type: "article"
tags: ["article", "mathematics", "programming", "machine learning", "graph theory"]
date: "January 23, 2024"
---

import AbstractFunction from './AbstractFunction.svelte';
import FamiliarFunction from './FamiliarFunction.svelte';
import AverageNotInstant from './AverageNotInstant.svelte';
import StraightGraph from './StraightGraph.svelte';
import NotStraightGraph from './NotStraightGraph.svelte';

import Hover from '@/components/Hover.svelte';

> <span class='note'>Note:</span><br />
> This article assumes that you have a basic understanding of functions and derivatives. Below is a quick overview which you can skip if you already know what is the deal with these concepts. 
>
> Also, everything in this article is just my views on the subject. I will only talk about the concept that I understand and the one I use to implement a simple library to work with all of these idea. 

# Overview
## Function

A function tells us how things turn into another. The things that get in/out of a function can be anything, including a function itself.

<AbstractFunction client:load />

This is a very abstract definition of a function. A more familiar form is the one that takes in a number and gives out, potentially, a different number.

$$
f(x) = x^2
$$

<FamiliarFunction client:load />

## Derivative
The concept of derivative is beautiful. I wrote another article purely dedicated to this which you can read [here](/articles/derivative) (probably doesn't exist yet).

All you need to know for this article is that:

1. You want to know how a function $f(x)$ is changing at a specific input $a$.
2. To determine if or how something is changing, we need at least two data points to see the difference.

$$
\frac{f(b) - f(a)}{b - a} 
$$

(divide the change in output by the change in input to find the rate of change)

3. But two is not one. We want to know the rate of change of the function at $a$ not an overall average, from $a$ to $b$.

<AverageNotInstant client:load />

$$
y = f(x) = x^2
$$

4. With derivative, we simply ask: "what if those two points were very close together?" Not on top of one another, but very close. Try moving the red dot closer to the blue one and see how the rate of change match up.

$$
\lim_{b\to a} \frac{f(b) - f(a)}{b - a}
$$

With **Limit** we can make $b$ approach $a$. But remember, $b$ is not equal to $a$, they are very close. This is the derivative of $f(x)$ at $a$. 

Now, we can find the derivative of $f(x)$ at any point $x$. To do so, we increase $x$ by a small amount $h$ then divide the change in output by the change in input.

<div class="p-2 my-4 border border-[var(--pm-color)] border-dashed border-2 ">

$$
\frac{\mathrm{d} f }{\mathrm{d} x} =\; \lim_{h \to 0} \frac{f(x+h) - f(x)} {h}
$$

</div>

This is the **fundamental definition of derivative**. 

5. But we, sane individuals, would love to have a little abstraction. There are derivative rules on <Hover> 
    <span slot="toggler"> elementary functions </span>
    <ul> <li>power</li> <li>exponential</li> <li>trig function</li> <li>log</li> <li>...</li> </ul> 
</Hover> that can solve any complex function as long as applied with <Hover>
    <span slot="toggler">combinational derivative rules</span>
    <ul><li>summation of functions</li><li>product of functions</li><li>composition of function</li></ul>
</Hover>. The result is another function that can calculate the rate of change, precisely. 

<br />

# Why?

Let's make things clear before we continue. It is very easy to represent mathematical expression in a computer program. The function $f(x) = x^2$ can be written in [python](https://www.python.org/) as:
    
```python
def f(x):
    return x**2 # x square
```

And its derivative form with respect to $x$,
<Hover> <span slot="toggler"> $\mathrm{d}f/\mathrm{d}x = 2x$ </span> 
$x^2$ is a power function. <br /> $\frac{d}{dx}x^n = nx^{n-1}$ 
</Hover> , can be written as: 

```python 
def df(x):
    return 2*x
```

So, [why](https://www.merriam-webster.com/dictionary/why) am I writing this article? why can't we just... write it? Why do we need **computational graph**? And what is a graph anyway? 

We simply don't want to figure out and write the derivative of any function by hand. It is now a computer's job.

# Computational Graph

Consider the function:

$$
f(x) = e^{5x + 3}
$$

It can look very intimidating. But it is just a series of operations. First, we multiply $x$ by $5$, then add $3$, and finally raise $e$ to the result.

Below, is how you might visualize the operations:

<StraightGraph client:load />

By the way, this is a graph, a computational graph. It is consisted of connected nodes, each representing a math operation. The edges are the flow of output from one operation to another.

Let's take a look at another function:

$$
{\color{white} g(x) = {\color{orange}\sin}^2{\color{orange}(x)} + 3{\color{orange} \sin(x)} }
$$

And here is its graph:

<NotStraightGraph client:load />

One thing to note here is that when creating computational graph, we need to avoid redundant nodes and operations. The $sin(x)$ is being used twice in the function.

And this should be enough for us to get started with the concept of automatic differentiation or auto diff. But we will go back and forth between these two.

# Differentiation

There are a few methods to find the derivative of a function. Auto diff is just one of them that work well in a computer program.

## Symbolic Differentiation
This is the method we might use when finding the derivative by hand.

For example, if we have the following function:

$$
f(x, y) = x^2 + \sin(x + y^2) 
$$

Its derivative with respect to $x$ is:

$$
\frac{\partial f} {\partial x} = 2x + \cos(x + y^2)
$$

Since $f$ take in two inputs, we use the symbol $\partial$ to denote the partial derivative, the derivative of $f$ with respect to one of its many inputs.

This mean that we can also find the derivative of $f$ with respect to $y$:

$$
\frac{\partial f} {\partial y} = \cos(x + y^2) \cdot 2y
$$

Now, here is the problem. Each derivative is another function. If the original function has a lot of parameters (input), we would also have a lot of new function for each inputs. Of course there are ways to optimize this. The **main problem** of this method is that it could leads to a very complicated function very quickly.

As a homework, try it out on function that require **product rules**.

## Numerical Differentiation

Another method use the **fundamental definition of derivative** to find the rate of change of a function at a specific point. We call it **numerical differentiation**

$$
\frac{\mathrm{d} f }{\mathrm{d} x} =\; \lim_{h \to 0} \frac{f(x+h) - f(x)} {h}
$$

Here is how you might implement it in python:

```python
def df(f, x, h=1e-5):
    return (f(x+h) - f(x)) / h
```

It's simple, but let's not waste our time on this. $h$ need to be an incredibly small number, and computer are very bad with that. But please don't just take my word for it. Try out the code and compare them with the infinitely accurate symbolic method.

## Automatic Differentiation

# Implementation with OOP
